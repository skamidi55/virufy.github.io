{"version":3,"sources":["hooks/useHeaderContext.ts","helper/scrollHelper.ts","assets/icons/exclamationCircle.svg","containers/SubmitSteps/Submission/Sending/Sending.tsx"],"names":["useHeaderContext","React","useContext","HeaderContext","title","setTitle","subtitle","setSubtitle","type","setType","logoSize","setLogoSize","setDoGoBack","doGoBack","scrollToTop","window","scrollTo","top","behavior","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_ref2","createElement","d","_ref3","points","_ref4","SvgExclamationCircle","_ref","svgRef","props","width","height","viewBox","fill","ref","ForwardRef","forwardRef","toBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","split","onerror","error","memo","p","useState","setActiveStep","t","useTranslation","state","useStateMachine","history","useHistory","setError","sendDataToBackend","useCallback","a","structuredData","patientId","gender","biologicalSex","age","ageGroup","conditions","currentMedicalCondition","latitude","location","longitude","coughFile","recordYourCough","recordingFile","uploadedFile","Blob","coughBase64","fetch","process","method","headers","body","JSON","stringify","response","json","console","log","nextStep","push","handleDoBack","previousStep","goBack","mocksendDataToBackend","sick","setTimeout","useEffect","style","display","justifyContent","alignItems","marginTop","errors","name","render"],"mappings":"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","file":"static/js/39.480c0318.chunk.js","sourcesContent":["import React from 'react';\r\nimport { HeaderContext } from 'components/Header';\r\n\r\nconst useHeaderContext = () => {\r\n  const {\r\n    title, setTitle, subtitle, setSubtitle, type, setType, logoSize, setLogoSize, setDoGoBack, doGoBack,\r\n  } = React.useContext(HeaderContext);\r\n\r\n  return {\r\n    title,\r\n    setTitle,\r\n    subtitle,\r\n    setSubtitle,\r\n    type,\r\n    setType,\r\n    logoSize,\r\n    setLogoSize,\r\n    doGoBack,\r\n    setDoGoBack,\r\n  };\r\n};\r\n\r\nexport default useHeaderContext;\r\n","export const scrollToTop = function scrollToTop() {\r\n  window.scrollTo({ top: 0, behavior: 'smooth' });\r\n};\r\n\r\nexport const scrollToBottom = function scrollToBottom() {\r\n  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });\r\n};\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M13.983,0C6.261,0,0.001,6.259,0.001,13.979c0,7.724,6.26,13.984,13.982,13.984s13.98-6.261,13.98-13.984C27.963,6.259,21.705,0,13.983,0z M13.983,26.531c-6.933,0-12.55-5.62-12.55-12.553c0-6.93,5.617-12.548,12.55-12.548c6.931,0,12.549,5.618,12.549,12.548C26.531,20.911,20.913,26.531,13.983,26.531z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"polygon\", {\n  points: \"15.579,17.158 16.191,4.579 11.804,4.579 12.414,17.158\"\n});\n\nvar _ref4 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M13.998,18.546c-1.471,0-2.5,1.029-2.5,2.526c0,1.443,0.999,2.528,2.444,2.528h0.056c1.499,0,2.469-1.085,2.469-2.528C16.441,19.575,15.468,18.546,13.998,18.546z\"\n});\n\nvar SvgExclamationCircle = function SvgExclamationCircle(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: \"24px\",\n    height: \"24px\",\n    viewBox: \"0 0 27.963 27.963\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3, _ref4);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgExclamationCircle, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/exclamationCircle.7bdc8e6b.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useEffect, useCallback, useState } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { useStateMachine } from 'little-state-machine';\r\nimport { ErrorMessage } from '@hookform/error-message';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\n// Icons\r\nimport { ReactComponent as ExclamationSVG } from 'assets/icons/exclamationCircle.svg';\r\n\r\n// Helper\r\nimport { scrollToTop } from 'helper/scrollHelper';\r\n\r\n// Hooks\r\nimport useHeaderContext from 'hooks/useHeaderContext';\r\n\r\nimport { ImageProcessing, TextErrorContainer} from '../style';\r\n\r\ninterface StructuredData {\r\n  patientId: string;\r\n  gender: string;\r\n  age: number;\r\n  conditions: string[]; \r\n  latitude: number;\r\n  longitude: number;\r\n}\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL!;\r\n\r\n// Helper function to convert file to Base64\r\nconst toBase64 = (file: Blob): Promise<string> => \r\n  new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = () => resolve((reader.result as string).split(',')[1]);  // Get the Base64 part only\r\n    reader.onerror = (error) => reject(error);\r\n});\r\n\r\nconst Sending = (p: Wizard.StepProps) => { \r\n  const [, setActiveStep] = useState(true);\r\n  const { setDoGoBack, setTitle, setType } = useHeaderContext();\r\n  const { t } = useTranslation();\r\n  const { state } = useStateMachine();\r\n  const history = useHistory();\r\n  const [error, setError] = React.useState<string | null>(null);\r\n\r\n\r\n  const sendDataToBackend = useCallback(async (): Promise<void> => {\r\n    try {\r\n      const structuredData: StructuredData = {\r\n        patientId: state['submit-steps']?.patientId,\r\n        gender: state['submit-steps']?.biologicalSex,\r\n        age: state['submit-steps']?.ageGroup,\r\n        conditions: state['submit-steps']?.currentMedicalCondition,\r\n        latitude: state['submit-steps']?.location['lat'],\r\n        longitude: state['submit-steps']?.location['lng'],\r\n      };\r\n      // Retrieve files from the state (either recorded or uploaded)\r\n      const coughFile = state['submit-steps']?.recordYourCough?.recordingFile || state['submit-steps']?.recordYourCough?.uploadedFile;\r\n      \r\n      if ((coughFile instanceof Blob)) {\r\n        const coughBase64 = await toBase64(coughFile);\r\n        const response = await fetch(apiUrl, {\r\n          method: 'POST',\r\n          headers: {\r\n            'content-type': 'application/json',\r\n          },\r\n          body: JSON.stringify({\r\n            structuredData: structuredData,\r\n            coughFile: coughBase64,\r\n          }),\r\n        });\r\n\r\n        const result = await response.json();\r\n        console.log('Response:', result);\r\n        if (p.nextStep)\r\n          history.push(p.nextStep)\r\n      } else {\r\n        console.error('Files not found.');\r\n      }\r\n    } catch {\r\n      console.error('Error sending data: Failed to send data.');\r\n      setError('Failed to send data.');\r\n    }\r\n  }, [state, history, p.nextStep]);\r\n\r\n  const handleDoBack = useCallback(() => {\r\n    if (p.previousStep) {\r\n      setActiveStep(false);\r\n      history.push(p.previousStep);\r\n    } else {\r\n      history.goBack();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n\r\n  const mocksendDataToBackend = useCallback(() => {\r\n    console.log('MOCK: sending to backend');\r\n    console.log(state);\r\n    console.log(\r\n      \"patientId\", state['submit-steps']?.patientId,\r\n      \"Conditions\",state['submit-steps']?.currentMedicalCondition, \r\n      \"location\",state['submit-steps']?.location['lat'], \r\n      \"location\",state['submit-steps']?.location['lng'], \r\n      \"sick\",state['submit-steps']?.sick,\r\n      \"gender\",state['submit-steps']?.biologicalSex,\r\n      \"age\",state['submit-steps']?.ageGroup,\r\n    );\r\n    setTimeout(() => {\r\n      if (p.nextStep) {\r\n        history.push(p.nextStep);\r\n      }\r\n    }, 2000);\r\n  }, [state, history, p.nextStep]);\r\n\r\n  useEffect(() => {\r\n    scrollToTop();\r\n    setTitle('');\r\n    setType('tertiary');\r\n    setDoGoBack(null);\r\n    sendDataToBackend();\r\n    // mocksendDataToBackend();\r\n  }, [handleDoBack, setDoGoBack, setTitle, setType, sendDataToBackend, mocksendDataToBackend]);\r\n\r\n  return (\r\n    <>\r\n      <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', marginTop: '50px' }}>\r\n        <h1>{t('submit:submitting', 'Sending...')}</h1>\r\n      </div>\r\n      <ImageProcessing />\r\n      {error && (\r\n        <ErrorMessage\r\n          errors={{ error }}\r\n          name=\"error\"\r\n          render={() => (\r\n            <TextErrorContainer>\r\n              <ExclamationSVG />\r\n              {error}\r\n            </TextErrorContainer>\r\n          )}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default React.memo(Sending);\r\n"],"sourceRoot":""}